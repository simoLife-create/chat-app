#!/bin/bash

# R√©pertoire courant
WORKSPACE_DIR=$(pwd)
TEMP_FILE="/tmp/code_content_$(date +%Y%m%d_%H%M%S).txt"

echo "üîç Recherche des fichiers dans le workspace..."
echo "üìÇ Workspace: $WORKSPACE_DIR"

# Trouver tous les fichiers .fxml et .java, en excluant les r√©pertoires sp√©cifi√©s
find "$WORKSPACE_DIR" \
    -type f \( -name "*.fxml" -o -name "*.java" \) \
    ! -path "*/node_modules/*" \
    ! -path "*/target/*" \
    ! -path "*/.git/*" \
    ! -path "*/dist/*" \
    ! -path "*/build/*" \
    ! -path "*/out/*" \
    ! -path "*/.idea/*" > "$TEMP_FILE.list"

# Compter les fichiers
FILE_COUNT=$(wc -l < "$TEMP_FILE.list")

# V√©rifier si des fichiers ont √©t√© trouv√©s
if [ "$FILE_COUNT" -eq 0 ]; then
    echo "‚ùå Aucun fichier .fxml ou .java trouv√© dans le workspace (en excluant les r√©pertoires sp√©cifi√©s)."
    rm "$TEMP_FILE.list"
    exit 1
fi

echo "üî¢ Nombre de fichiers trouv√©s: $FILE_COUNT"

# Initialiser le fichier temporaire
echo "" > "$TEMP_FILE"

# Pour chaque fichier, ajouter son chemin et son contenu au fichier temporaire
while IFS= read -r file; do
    echo -e "\n\n// ============================================" >> "$TEMP_FILE"
    echo -e "// FICHIER: $file" >> "$TEMP_FILE"
    echo -e "// ============================================\n" >> "$TEMP_FILE"
    cat "$file" >> "$TEMP_FILE"
done < "$TEMP_FILE.list"

# Copier le contenu dans le presse-papiers (macOS)
if command -v pbcopy &> /dev/null
then
    cat "$TEMP_FILE" | pbcopy
    echo "‚úÖ Contenu copi√© dans le presse-papiers (pbcopy) !"
# Copier le contenu dans le presse-papiers (Linux - needs xclip or xsel)
elif command -v xclip &> /dev/null
then
    cat "$TEMP_FILE" | xclip -selection clipboard
    echo "‚úÖ Contenu copi√© dans le presse-papiers (xclip) !"
elif command -v xsel &> /dev/null
then
    cat "$TEMP_FILE" | xsel -b -i
    echo "‚úÖ Contenu copi√© dans le presse-papiers (xsel) !"
else
    echo "‚ùå Aucun outil de presse-papiers trouv√© (pbcopy, xclip, xsel). Contenu non copi√©."
fi

echo "üìã $FILE_COUNT fichiers copi√©s (code source uniquement, pas d'images)"

# Nettoyer les fichiers temporaires
rm "$TEMP_FILE" "$TEMP_FILE.list"

exit 0